# Security Task Priorities

1. **Protect stored user data (Phase 4: Subtasks 17–19)** — Encrypt JSON persistence with Fernet, verify decrypt/ tamper detection tests, and ensure backups use the same encryption. Critical for confidentiality and integrity of user content; should not be skipped.
2. **Stop prompt-injection and malicious channels (Phase 4: Subtasks 1–7)** — Catalogue LLM entry points, codify sanitization rules, add `prompt_guard`, integrate guardrails, maintain a blocklist, and add regression tests. Directly mitigates high-risk AI abuse; must be completed.
3. **Centralize secrets management (Phase 3: Subtasks 12–15)** — Evaluate secret stores, build the adapter, wire configuration, and draft the production migration checklist. Prevents credential leakage and supports later rotations; execute early.
4. **Ensure storage concurrency safety (Phase 2: Subtasks 1–7)** — Inventory usage, add singleton factory with shared locks, migrate call sites, harden locking, extend concurrency tests, add rate-limit logging, and run verification sweep. Prevents data corruption under load; essential.
5. **Apply AI & scraper throttles (Phase 3: Subtasks 1–11)** — Lower concurrency defaults, implement RPM throttles, add failure instrumentation, enforce per-user/global embedding limits, gate scraper concurrency/RPM, communicate rate-limit results, and document thresholds. Contains abuse, cost spikes, and outage risk; high priority.
6. **Build actionable observability (Phase 3: Subtasks 16–20 & Phase 4: Subtasks 13–16)** — Create metrics module, instrument code paths, expose a secured `/metrics`, codify alert thresholds, test alert pipeline, finalize Prometheus exporter toggles, add alert rule files, and expand the monitoring runbook. Needed for detection/response; prioritize.
7. **Stand up audit logging (Phase 4: Subtasks 8–12)** — Implement rotating audit logger, wire admin events, enforce file permissions, add forensic export tooling, and document retention policy. Enables incident forensics and accountability; do not skip.
8. **Harden container runtime (Phase 2: Subtasks 8–11 & 13)** — Run as non-root, add Docker health check, enforce runtime directory permissions, tighten `.dockerignore`, and align Dockerfile with prod requirements. Reduces attack surface; schedule soon after above items.
9. **Secure dependency posture (Phase 2: Subtasks 12–16 & 14)** — Split prod/dev requirements, pin critical HTTP client dependency, integrate pip-audit/bandit into CI, configure dependency bot. Prevents supply-chain regressions; medium-high priority.
10. **Incident response readiness (Phase 4: Subtasks 20–22 & Phase 3: Subtask 21)** — Draft full IR runbook, schedule quarterly security reviews, run Phase verification suites, and produce final reports. Important for preparedness but can follow technical mitigations.
11. **Operational hygiene & sign-offs (Phase 2: Subtask 18, Phase 3: Subtask 22, Phase 4: Subtask 23, Phase 2: Subtask 17)** — Team communications, retrospectives, documentation refreshes, and executive approvals. Valuable for coordination but can be delayed if time-constrained.
